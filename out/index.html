<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>filog</title>
	<meta name="description" content="Documentation for filog">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">filog</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>Project filog</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#filog-a-meteor-19-logging-package" id="filog-a-meteor-19-logging-package" style="color: inherit; text-decoration: none;">
					<h1>FiLog: a Meteor 1.9 logging package</h1>
				</a>
				<p><a href="https://travis-ci.org/fgm/filog"><img src="https://travis-ci.org/fgm/filog.svg?branch=master" alt="Build Status"></a>
					<a href="https://codecov.io/gh/fgm/filog"><img src="https://codecov.io/gh/fgm/filog/branch/master/graph/badge.svg" alt="CodeCov Test Coverage"></a>
					<a href="https://codebeat.co/projects/github-com-fgm-filog-63ts-source_processor"><img src="https://codebeat.co/badges/b1379317-2bc2-4059-b640-c393f3ad20ea" alt="codebeat badge"></a>
					<a href="https://snyk.io/test/github/fgm/filog?targetFile=package.json"><img src="https://snyk.io/test/github/fgm/filog/badge.svg?targetFile=package.json" alt="Known Vulnerabilities"></a>
				<a href="https://app.fossa.io/projects/git%2Bgithub.com%2Ffgm%2Ffilog?ref=badge_shield"><img src="https://app.fossa.io/api/projects/git%2Bgithub.com%2Ffgm%2Ffilog.svg?type=shield" alt="FOSSA Status"></a></p>
				<p>FiLog is a highly configurable isomorphic logger for Meteor applications,
					supporting configurable logging strategies and custom processing and log sending
				destinations.</p>
				<p>Out of the box, it can log to the console (browser, server), the Meteor database,
					any Syslog server, and includes a &quot;tee&quot; logger to send to multiple destinations.
					On the browser, it can log to its own Meteor server over DDP, or to a
				centralized FiLog log aggregation server over HTTP.</p>
				<p>FiLog is based upon low-level NPM packages::</p>
				<ul>
					<li>Stack capture and standardization: <a href="https://www.npmjs.com/package/tracekit">https://www.npmjs.com/package/tracekit</a></li>
					<li>Meteor user capture in call stack: <a href="https://www.npmjs.com/package/callsite">https://www.npmjs.com/package/callsite</a></li>
				</ul>
				<p>Read the <a href="https://fgm.github.io/filog">Documentation</a>.</p>
				<a href="#configuration-and-usage" id="configuration-and-usage" style="color: inherit; text-decoration: none;">
					<h2>Configuration and usage</h2>
				</a>
				<a href="#main-ideas" id="main-ideas" style="color: inherit; text-decoration: none;">
					<h4>Main ideas:</h4>
				</a>
				<ul>
					<li>A logged event is a <code>(level, message, context)</code> triplet, in which<ul>
							<li><code>level</code> is an RFC5424 number (0..7)</li>
							<li><code>message</code> is a plain string or can be converted to one automatically</li>
							<li><code>context</code> is a plain Object</li>
						</ul>
					</li>
					<li>the package has no configuration of its own, it is entirely
						configured by its users, the client- and server-side Meteor parts of the
					application.</li>
					<li>Both client and server applications may capture exception stack traces and log
						them for plain errors (<code>window.onerror</code> handling) and exception reporting.
						This is triggered by the <code>logger.arm()</code> method, and can be disabled by the
					<code>logger.disarm()</code> method.</li>
				</ul>
				<a href="#typical-use-case" id="typical-use-case" style="color: inherit; text-decoration: none;">
					<h4>Typical use case:</h4>
				</a>
				<ul>
					<li><p><code>client/main.js</code>:</p>
						<ul>
							<li><p>instantiates any number of &quot;processors&quot;: instances of classes derived from
									<code>ProcessorBase</code>. These are able to add information to a message on its way
								to the logging destination. Current concrete processors are:</p>
								<ul>
									<li><code>BrowserProcessor</code>: adds browser-related information, such as user
									agent, platform, operating system, client memory</li>
									<li><code>MeteorUserProcessor</code>: adds user-related information if any is
										available. Assumes the application is configured with some Meteor
									accounts package, like <code>fgm:accounts-drupal</code>.</li>
									<li><code>RoutingProcessor</code>: adds request-related information, such as the
									path being served.</li>
								</ul>
							</li>
							<li><p>instantiates any number of &quot;senders&quot;: instances of classes derived from
									<code>SenderBase</code>. These are able to receive a <code>(level, message, context)</code>
									triplet (&quot;event&quot;) and forward it somwhere else. Current concrete senders
								are:</p>
								<ul>
									<li><code>ConsoleSender</code>: output the message using <code>console.log</code></li>
									<li><code>MeteorClientHttpSender</code>: HTTP POST the message to the Meteor server
										present at the URL defined by the Meteor-standard <code>ROOT_URL</code>
									environment variable.</li>
									<li><code>MongodbSender</code>: store the event in a collection in the Meteor MongoDB
									database instance (or the minimongo on the client).</li>
									<li><code>NullSender</code>: ignore the message.</li>
									<li><code>SyslogSender</code>: send the event to syslog, on server only: including it on
									client will fail.</li>
									<li><code>TeeSender</code>: send the event to all sender instances passed to its
									constructor as an array. Useful to send logs to multiple destinations.</li>
								</ul>
							</li>
							<li><p>instantiate a sending &quot;strategy&quot;: instance of a class derived from
									<code>StrategyBase</code>. There are able to decide, based on an event, where it
									should be sent by available senders. They may also modify the logger
									instance at the last step of its construction, Two concrete strategies are
								currently available:</p>
								<ul>
									<li><code>LeveledStrategy</code>: based on the level of the message, it defines three
										severity levels: low, medium, and high, as well as the breakpoints
										between them in terms of RFC5424 levels, and associates a sender
									instance with each of these levels</li>
									<li><code>TrivialStrategy</code> uses a single sender for all messages. Especially useful
										for early work client-side, where you want everything to be stored to
										collect as much information as possible from a limited number of clients.
									May also be useful for tests, to simplify test setup.</li>
								</ul>
							</li>
							<li><p>constructs a <code>ClientLogger</code> instance, passing it the strategy instance, like:</p>
								<pre><code><span style="color: #000000">  </span><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">logger</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">ClientLogger</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">LeveledStrategy</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">NullSender</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">ConsoleSender</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">MeteorClientHttpSender</span><span style="color: #000000">(</span><span style="color: #001080">Meteor</span><span style="color: #000000">.</span><span style="color: #795E26">absoluteUrl</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;logger&#039;</span><span style="color: #000000">))</span>
<span style="color: #000000">  ));</span>
</code></pre>
							</li>
							<li><p>adds processor instances to the logger instance, like:</p>
								<pre><code><span style="color: #000000">  </span><span style="color: #001080">logger</span><span style="color: #000000">.</span><span style="color: #001080">processors</span><span style="color: #000000">.</span><span style="color: #795E26">push</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">BrowserProcessor</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">RoutingProcessor</span><span style="color: #000000">(),</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">MeteorUserProcessor</span><span style="color: #000000">(</span><span style="color: #001080">Meteor</span><span style="color: #000000">)</span>
<span style="color: #000000">  );</span>
</code></pre>
							</li>
							<li><p>is now able to log events, like:</p>
								<pre><code><span style="color: #000000">  </span><span style="color: #001080">logger</span><span style="color: #000000">.</span><span style="color: #795E26">warn</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;Some warning condition&quot;</span><span style="color: #000000">, { </span><span style="color: #001080">foo:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;bar&quot;</span><span style="color: #000000"> });</span>
</code></pre>
							</li>
							<li><p>with this configuration:</p>
								<ul>
									<li>logger applies processors to add browser, user, and routing information
									to the message context</li>
									<li>since warnings are considered worthy of storage (default configuration
										of the <code>LeveledStrategy</code> constructor), the logger passes the now-rich
										message to the Meteor server thanks to the <code>MeteorClientHttpSender</code>
									sender</li>
									<li>message arrives server-side.</li>
								</ul>
							</li>
						</ul>
					</li>
					<li><p><code>server/main.js</code></p>
						<ul>
							<li><p>is configured in much the same way as the client, so it has its own <code>logger</code>,
								typically configured with just a <code>MongodbSender</code> instance for all levels.</p>
								<pre><code><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">sender</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">MongodbSender</span><span style="color: #000000">(</span><span style="color: #001080">Mongo</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;logger&#039;</span><span style="color: #000000">);</span>
<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">logger</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">ServerLogger</span><span style="color: #000000">(</span>
<span style="color: #000000">  </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">LeveledStrategy</span><span style="color: #000000">(</span><span style="color: #001080">sender</span><span style="color: #000000">, </span><span style="color: #001080">sender</span><span style="color: #000000">, </span><span style="color: #001080">sender</span><span style="color: #000000">),</span>
<span style="color: #000000">  </span><span style="color: #001080">WebApp</span><span style="color: #000000">);</span>
<span style="color: #001080">logger</span><span style="color: #000000">.</span><span style="color: #001080">processors</span><span style="color: #000000">.</span><span style="color: #795E26">push</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">MeteorUserProcessor</span><span style="color: #000000">());</span>
</code></pre>
							</li>
							<li><p>in the example above, it receives the POSTed event, and proceed to log it</p>
								<ul>
									<li>because it has already been processed client-side, it is logged &quot;raw&quot;,
									without applying additional processors to it</li>
									<li>the MongoDb sender instance stores the event.</li>
								</ul>
							</li>
							<li><p>the server may also initiate a logging action, for example in a publish
								function or Meteor method. It can use the same API:</p>
								<pre><code><span style="color: #001080">logger</span><span style="color: #000000">.</span><span style="color: #795E26">error</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;Some server condition&quot;</span><span style="color: #000000">, { </span><span style="color: #001080">baz:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;quux&quot;</span><span style="color: #000000"> }</span>
</code></pre>
								<ul>
									<li>since the message is server-originated, the server processors will be
									applied, to add the Meteor user information to the event</li>
									<li>the MongoDb sender instance stores the event.</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
				<a href="#format-note" id="format-note" style="color: inherit; text-decoration: none;">
					<h2>Format note</h2>
				</a>
				<ul>
					<li>Whatever the enabled processors, the <code>Logger.log()</code> method adds a
					millisecond-level timestamp to each context, under the <code>timestamp.log</code> key.</li>
					<li>Senders designed to exit the system, like the MongoDB sender, or a syslog or
						logstash Beats forwarder, are expected to add another millisecond-level
					timestamp, under the <code>timestamp.store</code> key.</li>
				</ul>
				<p>These two timestamps are here to alleviate any issue resulting from a clock
				difference between clients and servers.</p>
				<p>Any sender can add extra keys to the context, under the <code>timestamp</code> main key,
				to enable timing diagnostics.</p>
				<a href="#running-tests" id="running-tests" style="color: inherit; text-decoration: none;">
					<h2>Running tests</h2>
				</a>
				<p>The module contains tests. Some of them are unit tests and need nothing special
					to run, while others are currently implemented as integration tests and assume
					you have a working harness project using Filog, exposed on
				<code>http://localhost:3000</code>.</p>
				<p>Start by compiling the package:</p>
				<ul>
					<li><code>meteor yarn run ts-compile</code></li>
				</ul>
				<p>Then you can run :</p>
				<ul>
					<li>just unit tests with <code>meteor yarn run test-unit</code> </li>
					<li>just integration tests with <code>meteor yarn run test-integration</code></li>
					<li>both tests with <code>meteor yarn run test</code></li>
					<li>both tests including coverage generation with <code>meteor yarn run cover</code></li>
				</ul>
				<p>To run integration tests, you need to run the provided test_harness project in
					one terminal, and the tests in another one. Alternatively, you could also roll
				your own bespoke test harness, which will need to have Filog configured.</p>
				<a href="#example-server-side-code-in-the-test_harness-directory" id="example-server-side-code-in-the-test_harness-directory" style="color: inherit; text-decoration: none;">
					<h4>Example server-side code in the test_harness/ directory</h4>
				</a>
				<p>This file is needed to allow Filog to operate on the <code>/logger</code> URL: otherwise,
					Meteor will handle it natively and return a 200 with the default application
				page, failing the integration tests.</p>
				<a href="#terminal-1" id="terminal-1" style="color: inherit; text-decoration: none;">
					<h4>Terminal 1</h4>
				</a>
				<pre><code class="language-bash"><span style="color: #795E26">cd</span><span style="color: #000000"> (filog_dir)/test_harness</span>
<span style="color: #000000">meteor yarn</span>
<span style="color: #000000">meteor run --port 3100</span>
</code></pre>
				<p>This example uses port 3100 to avoid conflicting with existing applications on
					the default Meteor port (3000). To use another port, be sure to change it in
				<code>__tests__/integration/harness.ts</code> too.</p>
				<a href="#terminal-2" id="terminal-2" style="color: inherit; text-decoration: none;">
					<h4>Terminal 2</h4>
				</a>
				<pre><code class="language-bash"><span style="color: #795E26">cd</span><span style="color: #000000"> (filog_dir)</span>
<span style="color: #000000">meteor yarn</span>
<span style="color: #000000">meteor yarn run compile</span>
<span style="color: #000000">meteor yarn run </span><span style="color: #795E26">test</span>
<span style="color: #000000">meteor yarn run cover</span>
</code></pre>
				<p><strong>TIP</strong> Reading the <code>.travis.yml</code> file can be useful too.</p>
				<a href="#license" id="license" style="color: inherit; text-decoration: none;">
					<h2>License</h2>
				</a>
				<p><a href="https://app.fossa.io/projects/git%2Bgithub.com%2Ffgm%2Ffilog?ref=badge_large"><img src="https://app.fossa.io/api/projects/git%2Bgithub.com%2Ffgm%2Ffilog.svg?type=large" alt="FOSSA Status"></a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/loglevel.html">Log<wbr>Level</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class">
						<a href="classes/browserprocessor.html" class="tsd-kind-icon">Browser<wbr>Processor</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/clientlogger.html" class="tsd-kind-icon">Client<wbr>Logger</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/consolesender.html" class="tsd-kind-icon">Console<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/invalidargumentexception.html" class="tsd-kind-icon">Invalid<wbr>Argument<wbr>Exception</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/leveledstrategy.html" class="tsd-kind-icon">Leveled<wbr>Strategy</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/logger.html" class="tsd-kind-icon">Logger</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/meteorclienthttpsender.html" class="tsd-kind-icon">Meteor<wbr>Client<wbr>Http<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/meteorclientmethodsender.html" class="tsd-kind-icon">Meteor<wbr>Client<wbr>Method<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/meteoruserprocessor.html" class="tsd-kind-icon">Meteor<wbr>User<wbr>Processor</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/mongodbsender.html" class="tsd-kind-icon">Mongodb<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/nullsender.html" class="tsd-kind-icon">Null<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/processorbase.html" class="tsd-kind-icon">Processor<wbr>Base</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/routingprocessor.html" class="tsd-kind-icon">Routing<wbr>Processor</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/senderbase.html" class="tsd-kind-icon">Sender<wbr>Base</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/serverlogger.html" class="tsd-kind-icon">Server<wbr>Logger</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/strategybase.html" class="tsd-kind-icon">Strategy<wbr>Base</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/syslogsender.html" class="tsd-kind-icon">Syslog<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/teesender.html" class="tsd-kind-icon">Tee<wbr>Sender</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/trivialstrategy.html" class="tsd-kind-icon">Trivial<wbr>Strategy</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>